name: Create Rooter2305 Patch

on:
  workflow_dispatch:
  #push:
  #  branches:
  #    - main  # Atur sesuai dengan nama cabang yang diinginkan

env:
  TZ: Asia/Jakarta

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Clone Repo
      run: git clone https://github.com/ofmodemsandmen/ROOterSource2305.git openwrt

    - name: Create Rooter2305 Patch
      run: |
        echo "DATETIME=$(date +'%Y.%m.%d-%H:%M:%S')" >> $GITHUB_ENV
        cp -rf openwrt/package/rooter-builds/0protocols/luci-proto-3x/* ./luci-proto-3x
        cp -rf openwrt/package/rooter-builds/0protocols/luci-proto-mbim/* ./luci-proto-mbim
        cp -rf openwrt/package/rooter-extra/ext-netselect/* ./ext-netselect
        cp -rf openwrt/package/rooter-extra/ext-selectisp/* ./ext-selectisp
        cp -rf openwrt/package/rooter-extra/ext-simpin/* ./ext-simpin
        cp -rf openwrt/package/rooter-extra/ext-simplegps/* ./ext-simplegps
        cp -rf openwrt/package/rooter-extra/netrestart/* ./netrestart
        cp -rf openwrt/package/rooter/0basicapps/ext-command/* ./ext-command
        cp -rf openwrt/package/rooter/0basicapps/ext-extra/* ./ext-extra
        cp -rf openwrt/package/rooter/0basicsupport/ext-buttons/* ./ext-buttons
        cp -rf openwrt/package/rooter/0basicsupport/ext-sms/* ./ext-sms
        cp -rf openwrt/package/rooter/0drivers/rmbim/* ./rmbim
        cp -rf openwrt/package/rooter/0drivers/rqmi/* ./rqmi
        cp -rf openwrt/package/rooter/ext-rooter-basic/* ./ext-rooter-basic
        rm -rf openwrt

    - name: Commit Changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m " RooterUpdate : ${{ env.DATETIME }}"
        git push
